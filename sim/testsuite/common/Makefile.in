# Makefile for regression testing the GNU debugger.
# Copyright (C) 1997-2017 Free Software Foundation, Inc.

# This file is part of GDB.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

VPATH = @srcdir@:$(srccom)
srcdir = @srcdir@
srcroot = $(srcdir)/../../..
srccom = $(srcdir)/../../common

CC=gcc
CFLAGS = -Wall -Werror -I../../../bfd -I$(srccom) -I$(srcdir)/../../../include -g
default: check


# Verify SIM-BITS

check: bits32m0.ok bits32m31.ok bits64m0.ok bits64m63.ok
all: bits32m0 bits32m31 bits64m0 bits64m63

bits32m0.c: bits-gen bits-tst.c
	./bits-gen 32 0 big > tmp-bits32m0.c
	cat $(srcdir)/bits-tst.c >> tmp-bits32m0.c
	mv tmp-bits32m0.c bits32m0.c
bits32m31.c: bits-gen bits-tst.c
	./bits-gen 32 31 little > tmp-bits32m31.c
	cat $(srcdir)/bits-tst.c >> tmp-bits32m31.c
	mv tmp-bits32m31.c bits32m31.c
bits64m0.c: bits-gen bits-tst.c
	./bits-gen 64 0 big > tmp-bits64m0.c
	cat $(srcdir)/bits-tst.c >> tmp-bits64m0.c
	mv tmp-bits64m0.c bits64m0.c
bits64m63.c: bits-gen bits-tst.c
	./bits-gen 64 63 little > tmp-bits64m63.c
	cat $(srcdir)/bits-tst.c >> tmp-bits64m63.c
	mv tmp-bits64m63.c bits64m63.c


# Verify SIM-FPU
#
# The SIM-FPU test uses berkeley testfloat and softfloat not included
# within GDB to test.  They can be symlinked in to the binutils-gdb source
# root if this testing is needed.
#
#check: fpu-tst.ok
#all: fpu-tst

CFLAGS += -I$(srcroot)/softfloat -I$(srcroot)/softfloat/include/x86-gcc
CFLAGS += -I$(srcroot)/testfloat

VPATH += $(srcroot)/softfloat:$(srcroot)/testfloat

fpu-tst: testfloat
	echo './testfloat -all' > fpu-tst
	chmod 755 fpu-tst
fpu-tst.o: sim-fpu.c sim-bits.c
testfloat: fpu-tst.o \
	testfloat.o random.o fail.o writeHex.o \
	testLoops.o testFunction.o testCases.o \
	softfloat.o

# Verify SIM-ALU

check: alu-tst.ok
all: alu-tst
alu-tst.o: alu-tst.c alu-n-tst.h

clean:
	rm -f *.o
	rm -f *.ok
	rm -f bits32m0* bits32m31* bits64m0* bits64m63* bits-gen
	rm -f tmp-*
	rm -f alu-tst
	rm -f fpu-tst testfloat

.SUFIXES: .ok
%.ok: %
	./$<
	touch $<.ok
